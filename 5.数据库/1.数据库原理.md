

# 数据库体系结构
- 数据（data）：描述事物的**符号记录**称为数据。
- 数据库（DataBase，DB）：是长期存储在计算机内、有组织的、可共享的**大量数据的集合**，具有永久存储、有组织、可共享三个基本特点（，数据库即是一个文件）。
- 数据库管理系统（DataBase Management System，DBMS）：是位于用户与操作系统之间的一层**数据管理软件**。
- 数据库系统（DataBase System，DBS）：是有数据库、数据库管理系统（及其应用开发工具）、应用程序和数据库管理员（DataBase Administrator DBA）组成的**存储、管理、处理和维护数据的系统**。
![数据库体系结构](https://i.loli.net/2020/04/07/8oAuQ6v3ilDWFX1.png)


## 数据库完整性
- 数据库的完整性是指数据的正确性和相容性。
  - 完整性：为了防止数据库中存在不符合语义（不正确）的数据。
  - 安全性：为了保护数据库防止恶意破坏和非法存取。
- 触发器：是用户定义在关系表中的一类由事件驱动的特殊过程。

# 关系数据理论
## 数据依赖
- 数据依赖是一个关系内部属性与属性之间的一种约束关系，是通过属性间值的相等与否体现出来的数据间相关联系。
- 最重要的数据依赖：函数依赖、多值依赖。

## 范式
- 第一范式（1NF）：属性（字段）是最小单位不可再分。
- 第二范式（2NF）：满足 1NF，每个非主属性完全依赖于主键（消除 1NF 非主属性对码的部分函数依赖）。
- 第三范式（3NF）：满足 2NF，任何非主属性不依赖于其他非主属性（消除 2NF 主属性对码的传递函数依赖）。
- 鲍依斯-科得范式（BCNF）：满足 3NF，任何非主属性不能对主键子集依赖（消除 3NF 主属性对码的部分和传递函数依赖）。
- 第四范式（4NF）：满足 3NF，属性之间不能有非平凡且非函数依赖的多值依赖（消除 3NF 非平凡且非函数依赖的多值依赖）。


## 事务
### 事务的 ACID 特性


- **A 原子性**：一个事务（transaction）中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。事务在执行过程中发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。
- **C 一致性**：要求同一事务中的SQL语句，必须保证同时成功或者失败。
- **I 隔离性**：数据库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。
- **D 持久性**：事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。

> 在MySQL命令行的默认设置下，事务都是自动提交的，即执行SQL语句后就会马上执行 `COMMIT` 操作。因此要显式地开启一个事务务须使用命令 `BEGIN` 或 `START TRANSACTION`，或者执行命令 `SET AUTOCOMMIT=0`，用来禁止使用当前会话的自动提交。


#### 事务的隔离性

**事务的隔离性可分为四种 ( 性能从高到低，安全性从低到高 )** ：
1. **READ UNCOMMITTED ( 读取未提交 )**
   如果有多个事务，那么任意事务都可以看见其他事务的**未提交数据**。
2. **READ COMMITTED ( 读取已提交 )**
   只能读取到其他事务**已经提交的数据**。
3. **REPEATABLE READ ( 可被重复读 )**
   如果有多个连接都开启了事务，那么事务之间不能共享数据记录，否则只能共享已提交的记录。
4. **SERIALIZABLE ( 串行化 )**
   所有的事务都会按照**固定顺序执行**，执行完一个事务后再继续执行下一个事务的**写入操作**。



## 并发控制

| 事务隔离级别                 | 脏读 | 不可重复读 | 幻读 |
| ---------------------------- | ---- | ---------- | ---- |
| 读未提交（READ UNCOMMITTED） | 是   | 是         | 是   |
| 不可重复读（READ COMMITTED） | 否   | 是         | 是   |
| 可重复读（REPEATABLE READ）  | 否   | 否         | 是   |
| 串行化（SERIALIZABLE）       | 否   | 否         | 否   |

### 事务的并发问题
1. **脏读**：事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的数据是脏数据
2. **不可重复读**：事务 A 多次读取同一数据，事务 B 在事务A多次读取的过程中，对数据作了更新并提交，导致事务A多次读取同一数据时，结果不一致。
3. **幻读**：系统管理员A将数据库中所有学生的成绩从具体分数改为ABCDE等级，但是系统管理员B就在这个时候插入了一条具体分数的记录，当系统管理员A改结束后发现还有一条记录没有改过来，就好像发生了幻觉一样，这就叫幻读。

## 乐观锁与悲观锁
见操作系统[死锁与处理](../3.操作系统/5.死锁与处理.md)

---

# 基本概念

> 1. **实体**：客观存在可相互区别的事物
> 2. **属性**：实体具有的某一特性
> 3. **联系**：实体之间的联系通常是指不同实体集之间的联系。
> 4. **码**：唯一标识实体的属性集。
> 5. **实体型** 比如学生
> 6. **实体集** 比如全体学生
> 8. **模式**（schema）：模式也称逻辑模式，是数据库全体数据的逻辑结构和特征的描述，是所有用户的公共数据视图。
> 9. **外模式**（external schema）：外模式也称子模式（subschema）或用户模式，它是数据库用户（包括应用程序员和最终用户）能够看见和使用的局部数据的逻辑结构和特征的描述，是数据库用户的数据视图，是与某一应用有关的数据的逻辑表示。
> 10. **内模式**（internal schema）：内模式也称为存储模式（storage schema），一个数据库只有一个内模式。他是数据物理结构和存储方式的描述，是数据库在数据库内部的组织方式。

## 常用数据模型
> • 层次模型（hierarchical model）
> • 网状模型（network model）
> • 面向对象数据模型（object oriented data model）
> • 对象关系数据模型（object relational data model）
> • 半结构化数据模型（semistructure data model）
> • **关系模型**（relational model）

## 关系模型
1. **关系**（relation）：一个关系对应通常说的一张表
2. **元组**（tuple）：表中的一行即为一个元组
3. **属性**（attribute）：表中的一列即为一个属性
4. **码**（key）：表中可以唯一确定一个元组的某个属性组
   - _超码_：能在关系中唯一标志一个元组
   - _候选码_：最小超码
   - _主键_：用户明确定义的候选码，通常用下划线标记
   - _外码_：关系R上的属性B在关系S上是主键，则R上的属性B是参照S的外码，R为外码依赖的参照关系
1. **域**（domain）：一组具有相同数据类型的值的集合$$ D_1,D_2,...D_n $$
2. **分量**：元组中的一个属性值
3. **关系模式**：对关系的描述，一般表示为 关系名(属性1, 属性2, ..., 属性n)
4. **笛卡儿积**：每个域的基数相乘=行数，$ D_i $域的笛卡尔积$$ {D_1}\times{D_2}\times{...}\times{D_n} $$


 
## 关系操作
基本关系操作：
> **查询**：
>   - 选择`Select`   运算符$$\sigma $$，选择指定条件构成新关系
>   - 投影`Project`  运算符$$\Pi$$，投影指定属性名构成新关系，去除其中数据重复
>   - 连接(等值连接 自然连接`Natural join` 外连接) 运算符$$ \bowtie $$两个关系必须有同名属性，连接两个关系同名属性值相等的元组
>   - 除`Division` 
>   - 并`Union`  运算符$$\cup$$
>   - 差`set difference`  $$r-s$$，在r里去除s出现的元组
>   - 交`Set intersection`  运算符$$\cap$$
>   - 笛卡尔积`Cartesian product`  运算符$$r\times s$$
> 
> **插入**
> **删除**
> **修改**：
>   - 赋值`Assignment`  $$\rho {_X(A1,...An)}(E)$$返回E的结果，对关系E及属性重命名，也可以只重命名属性或关系名
>   - 重命名`Rename`

运算符示例：
$$\sigma_{A=C}(r \times s) $$ 选择属性A=C的
$$\Pi_{A,C}(r)$$ 投影关系r属性名AC的两列，并去除数据重复