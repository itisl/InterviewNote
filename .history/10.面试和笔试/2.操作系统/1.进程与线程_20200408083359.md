# 进程与线程
## 进程
* 进程实体的运行过程（动态的）
* 系统进行资源分配和调度的独立单位
### 进程实体
> 1. 程序段：程序的代码等
> 2. 数据段：程序处理的数据和变量
> 3. PCB（进程存在唯一标志）
>     * 进程描述信息：进程标识符PID，用户标识符UID
>     * 进程控制和管理信息
>         * 进程当前状态
>         * 进程优先级
>     * 资源分配清单
>         * 程序段指针
>         * 数据段指针
>         * 外设
>     * 处理机相关信息
>         * 各种寄存器的值
### 状态转换
* 状态
    * 运行状态
        * 占有CPU的一个核心并运行
    * 就绪状态
        * 已经具备运行条件，等待CPU执行
    * 阻塞状态
        * 充分条件不到位，CPU无法运行
    * 创建状态
     * > 操作系统为进程分配所需的内存空间等系统资源，并为其创建、初始化PCB

    * 终止状态
     * > 程序运行结束或者出现bug导致无法执行，操作系统回收资源

    * 概要: 三种基本状态
* 状态转换
    * 就绪态-->运行态
        * 程序被调度，CPU开始执行
    * 运行态-->就绪态
        * 时间片用完或者更高优先级的进程执行
    * 运行态-->阻塞态
        * 进程通过系统调用申请某种资源(如打印机等)，请求等待事件发生完才能继续执行（主动行为）
    * 阻塞态-->就绪态
        * 申请的资源被分配，可以继续执行（被动行为）
### 进程控制
* 作用：实现进程状态转换
* 原语
    * 进程创建fork()
     * > pid_t fork(void);
     * > 新进程是当前进程的子进程，子进程是父进程的复制，子进程开始和父进程并发运行fork()函数后续代码
     * > exec()函数簇
     * > 装入一个可执行程序，使子进程具有新功能

        * 创建原语
            * 申请空白PCB
            * 为新进程分配所需资源
            * 初始化PCB
            * 将PCB插入就绪队列
        * 进程创建的事件
            * 用户登录
            * 作业调度
            * 提供服务
            * 应用请求
    * 进程终止
        * 撤销原语
            * 从PCB集合中找到终止进程的PCB
            * 若进程正在进行，剥夺CPU并分配给其他线程
            * 终止所有子进程
            * 将该进程资源归还给父进程或操作系统
            * 删除PCB
        * 引起进程终止时间
            * 正常结束
            * 异常结束
            * 外界干预
    * 进程阻塞
        * 阻塞原语
            * 找到待阻塞进程的PCB
            * 保护进程运行现场，将PCB信息设为阻塞态，暂停进程运行
            * 将PCB插入相应事件的等待队列
        * 引起进程阻塞的事件
            * 需要等待系统分配某种资源
            * 需要等待相互合作的其他进程完成工作
    * 进程唤醒
        * 唤醒原语
            * 在事件等待队列中找到PCB
            * 将PCB从等待队列移除，设置为就绪态
            * 将PCB插入到就绪队列，等待被调度
        * 引起进程唤醒的事件
            * 等待的事件发生
    * 进程切换
        * 切换原语
            * 将运行环境信息存入PCB
            * PCB移入相应队列
            * 选择另一个进程执行并更新PCB
            * 根据PCB恢复新进程所需的运行环境
        * 引起进程切换的事件
            * 当前进程时间片用完
            * 更高优先级的进程到达
            * 进程主动阻塞
            * 当前进程终止
    * 概要: 阻塞和唤醒成对出现
### 进程通信
* (无名)管道
    * 半双工通信
        * 双向同时通信，需要设置两个管道
    * 亲缘进程之间，进程互斥访问
    * 无格式字符流形式写入管道
        * 管道写满，写进程系统调用write()将被阻塞
        * 管道变空，读进程系统调用read()将被阻塞
    * 速度慢，容量有限
* 命名管道
    * 是一种特殊文件格式
    * 可以用于无关进程的通信
* 消息队列
    * 是消息的链接表
* 共享内存
    * 最快的进程通信方式
* 信号量
    * 进程间以及同一进程不同线程的同步手段
* socket套接字
    * 用于不同机器间的进程通信
* 概要: 通常结合使用，用于进程间的同步、互斥
## 线程
### 线程概念
* 一个进程可能需要同时处理不同的事情
* 线程是基本的CPU执行单元
* 各线程可以并发，提高系统的并发度
* 引入线程后，进程作为基本的资源分配单元
### 实现方式
* 用户级线程
    * 线程管理由程序负责，在用户态下可以完成
        * 
* 内核级线程
* > 只有内核级线程才是CPU的处理单元

    * 线程管理由内核负责，在核心态下才能完成
        * 