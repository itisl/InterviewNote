# 编译与链接
---
[TOC]
---

## 如何运行一个C++程序？


### C++文件格式
| 编译器 | Microsoft Visual C++ | GCC（GNU C++）       | Borland C++ | UNIX       |
| ------ | -------------------- | -------------------- | ----------- | ---------- |
| 源文件后缀   | `.cpp` `.cxx` `.cc`         | `.cpp` `.cxx` `.cc` `.c++` `.C` | `.cpp`        | `.C` `.cc` `.cxx` |
### 从代码到可执行文件

> C++从源代码生成可执行文件的过程：

![20190813152426.png](https://raw.githubusercontent.com/itisl/Pic_Bed/master/img/20190813152426.png)
> 程序的生命周期阶段

![20190917163730.png](https://raw.githubusercontent.com/itisl/Pic_Bed/master/img/20190917163730.png)

### 使用`g++`命令行编译链接
> 常用命令
> - `-c` 生成`.o`目标文件
> - `-o`生成可执行文件
> - `-shared` 指定生成动态链接库
> - `-L` 要链接的库所在目录
> - `-l` 指定链接时需要的动态库，隐含命名规则，即在前加`lib`，在后加`.a`或`.so`确定库文件名
#### 1. 编译
> `-E`预处理命令，宏的替换，还有注释的消除，还有找到相关的库文件，生成Test.i文件
```sh
g++ -E Test.cpp
```
> `-S`命令将文件转换为汇编文件，生成Test.s文件
```sh
g++ -S Test.cpp
```
#### 2. 目标代码
> `-c`命令将文件转换为目标文件，生成Test.o文件

```sh
g++ -c Test.cpp
```
#### 3. 生成库文件
##### 动态库
##### 静态库

#### 4. 链接
> `-o`命令生成可执行文件Test(或Test.exe)，`-L`命令链接库文件路径，`-l`链接动态链接库`.so`

```sh
g++ Test.cpp -o name -L /usr/include/iostream
```

