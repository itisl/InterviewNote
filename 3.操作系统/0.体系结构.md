# 操作系统体系结构
![计算机系统层次结构](https://i.loli.net/2020/04/07/wLIx4QgaqrHjUk6.png)
## 运行机制
### 两种指令
* 特权指令
* > 如内存清零指令

* 非特权指令
* > 如加减乘除运算指令

### 两种处理器状态
> 用程序状态寄存器(PSW)的标志位来标识处理器状态。如0为用户态，1为核心态

* 用户态（目态）
* > 只能执行非特权指令。用户态→核心态的切换只能通过中断实现

* 核心态（管态）
* > 特权指令、非特权指令都可以执行。核心态→用户态一种特权指令将程序状态字PSW设为用户态

### 两种程序
* 内核程序
* > 运行在核心态，特权指令+非特权指令，是系统的管理者

* 应用程序
* > 只能执行非特权指令，运行在用户态

## 操作系统内核
### 时钟管理
// TODO
时间片轮换
### 中断和异常
* 中断作用
    * 引入中断机制，实现多道程序并发执行
    * 本质：CPU收到中断信号，立即切换到核心态，对中断进行处理
    * 中断是用户态→核心态的唯一途径
* 中断
    * 外中断
     * > 狭义的中断。来自CPU外部的信号，与当前执行指令无关。

        * 外设请求
         * > 如IO操作完成发出中断

        * 人工干预
         * > 如用户强制终止进程

    * 异常（内中断、例外、陷入）
     * > 信号来自当前执行的指令

        * 自愿中断——指令中断(trap)
         * > 如系统调用使用的访管指令(也叫陷入、trap指令)

        * 强迫中断
            * 硬件故障(fault)
             * > 如缺页中断

            * 软件中断(abort)
             * > 如整数除0
> 原语：
> * 是一种特殊的程序，处于操作系统最底层，最接近硬件的部分
> * 运行具有原子性，不可中断
> * 运行时间短，调用频繁
### 系统调用

### 系统资源管理
* 进程管理
* 存储管理
* 设备管理
## 大内核与微内核
### 大内核
* 将操作系统主要功能模块都作为核心态
* 优点：高性能
* 缺点：代码庞大，结构混乱，难以维护
### 微内核
* 只把最基本的功能保留在内核
* 优点：内核功能少，结构清晰，方便维护
* 缺点：性能低，需要在用户态和核心态频繁切换
