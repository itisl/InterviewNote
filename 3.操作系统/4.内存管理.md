# 内存管理
## 地址转换
### 操作系统实现逻辑地址到物理地址的转换
### 三种方式
* 绝对装入：编译器负责地址转换
* 可重定位装入：装入程序负责地址转换(早期阶段)
* 动态运行时装入：运行时才进行地址转换(现代操作系统)
## 存储保护
### 保证进程不会越界访问
### 两种方式
* 上下限寄存器
* 重定位寄存器+界地址寄存器
## 内存空间的分配与回收
### 连续分配管理
> 系统为进程所分配的必须是连续的一块内存

* 单一连续分配
    * 内存中只有一个用户程序
* 固定分区分配
    * 将内存的用户控件划分为固定大小的分区，每个分区运行一个程序
* 动态分区分配(可变分区分配)
    * 在进程装入内存，根据进程大小动态建立分区
    * 首次适应算法：每次从低地址查找满足大小的空闲分区
    * 最佳适应算法：优先分配满足要求的最小的空闲分区
     * > 缺点：会产生很多外部碎片

    * 最坏适应算法：优先分配最大的连续空闲分区
     * > 会很快将大分区分配完，导致后续大进程没有内存空间

    * 邻近适应算法：从上次分配完的地址开始查找满足大小的分区
### 非连续分配(离散分配方式)
* 基本分页存储管理
    * 把内存分为大小相等的分区，按照分区大小把进程拆分开，一般为4kb=2^12
* 基本分段存储管理
    * 区别：段的大小可以不相同，页的大小相同
    * 分段是信息的逻辑单位，对用户是可见的；分页是信息的物理单位，用户不可见
* 段页式存储管理
## 内存空间扩充(虚拟性)
### 覆盖技术
* 程序分成几个模块，按时间先后运行
### 交换技术
* 进程在内存与磁盘间动态调度
### 虚拟内存
* 定义和特征
    * 特征
        * 多次性
            * 程序允许被分成多次调入内存
        * 对换性
            * 程序运行时无需常驻内存，可以在运行过程中换入换出
        * 虚拟性
            * 逻辑上扩充了内存的容量
    * 容量
        * 最大容量
            * CPU寻址范围确定，32位系统为4GB
        * 实际容量
            * min(外存+内存，寻址范围)
* 局部性原理
    * 时间局部性：因为程序存在循环，某条指令不久后可能再次执行
    * 空间局部性：某个存储单元被访问后，附近的存储单元页很有可能被访问
    * 高速缓存技术
        * 将频繁访问数据放到更高速的存储器中，暂时用不到的放在低速存储器中
* 实现
    * 建立在离散分配的内存管理方式上
    * 请求分页管理
        * 页表机制
        * 缺页中断：内中断，属于故障
        * 地址变换
    * 页面置换算法
        * 最佳置换算法OPT
            * 每次淘汰以后最长时间不被访问的页面（理想化算法，无法实现）
        * 先进先出置换算法FIFO
            * 每次淘汰最早进入内存的页面
            * Belady异常：为进程分配的物理块增多时，缺页中断不减反增的异常现象
        * 最近最久未使用置换算法LRU
            * 将前面最久没有使用过的页面置换
            * 性能最接近OPT算法，但是实现困难，需要硬件支持，开销大
        * 时钟置换算法CLOCK
            * 将页面链接成循环队列，并增加访问位。访问过的页面访问位置为1；缺页中断时遇到访问位为1则置0，为0则置换，循环扫描
        * 改进时钟算法
            * 思想：被淘汰的页面如果没被修改，不需要写回外存浪费I/O，因此优先置换没被修改、没被访问的页面(访问位，修改位)为(0,0)
            * 在CLOCK算法基础上增加修改位。先扫描第一个(0,0)置换，不修改标志位；再扫描第一个(0,1)置换，访问位置0；再扫描第一个(0,0)置换，不修改标志位；再扫描第一个(0,1)置换
    * 页面分配策略
        * 驻留集：请求分页存储管理中给进程分配的物理块的集合
            * 太大：并发度下降，资源利用率低
            * 太小：频繁发生缺页中断
        * 页面分配、置换策略
            * 固定分配局部置换
                * 驻留集大小不变，缺页时进程只能使用自己的驻留集置换
            * 可变分配全局置换
                * 驻留集大小可变，缺页时可以将别的进程物理块置换
            * 可变分配局部置换
                * 驻留集大小可变，但是只使用自己的驻留集置换
        * 抖动(颠簸)
            * 刚换入的页面马上被换出，刚换出的马上又要换入
        * 工作集
            * 一定时间内，进程实际访问的页面集合
